## 项目树结构示意： 
```
f1ed-restsql-librestsql-master
│  .gitignore
│  README.md
│
├─.idea
│  │  .gitignore
│  │  f1ed-restsql-librestsql-master.iml
│  │  misc.xml
│  │  modules.xml
│  │  vcs.xml
│  │  workspace.xml
│  │
│  └─inspectionProfiles
│          profiles_settings.xml
│
├─doc
│      架构说明.md
│
├─restsql     -->restsql主要处理部分模块
│  │  __init__.py
│  │
│  ├─config   -->数据库静态文件处理文件模块
│  │  │  
│  │  │  db_setting.py  --->数据库配置对象
│  │  │  file_setting.py  --->静态配置文件处理模块
│  │  │  utils.py   --->处理静态数据库配置，对象转换，参数提取方法模块
│  │  │  __init__.py
│  │  │
│  │  └─__pycache__
│  │          db_setting.cpython-36.pyc
│  │          file_setting.cpython-36.pyc
│  │          utils.cpython-36.pyc
│  │          __init__.cpython-36.pyc
│  │
│  ├─datasource  -->具体数据库转义处理文件模块
│  │  │  __init__.py
│  │  │
│  │  ├─druid
│  │  ├─es
│  │  │  │  es_entry.py  --> es处理模块处理入口文件
│  │  │  │  __init__.py
│  │  │  │
│  │  │  └─__pycache__
│  │  │          __init__.cpython-36.pyc
│  │  │
│  │  ├─sql
│  │  │  │  sql_entry.py  -->postgresql 处理入口文件
│  │  │  │  __init__.py
│  │  │  │
│  │  │  └─__pycache__
│  │  │          __init__.cpython-36.pyc
│  │  │
│  │  └─__pycache__
│  │          __init__.cpython-36.pyc
│  │
│  └─__pycache__
│          __init__.cpython-36.pyc
│
├─RestSQLServer
│  │  db.sqlite3
│  │  manage.py
│  │  readme.md
│  │  restsql.yaml   --->静态数据库配置文件，以yaml形式存取
│  │  test1.py
│  │
│  ├─.idea
│  │  │  .gitignore
│  │  │  misc.xml
│  │  │  modules.xml
│  │  │  RestSQLServer.iml
│  │  │  workspace.xml
│  │  │
│  │  └─inspectionProfiles
│  │          profiles_settings.xml
│  │
│  ├─RestSQLServer    -->web服务文件夹
│  │  │  asgi.py
│  │  │  settings.py
│  │  │  urls.py   --->视图层接口映射处理模块
│  │  │  views.py  --->视图层处理模块
│  │  │  wsgi.py
│  │  │  __init__.py
│  │  │
│  │  └─__pycache__
│  │          settings.cpython-36.pyc
│  │          urls.cpython-36.pyc
│  │          views.cpython-36.pyc
│  │          wsgi.cpython-36.pyc
│  │          __init__.cpython-36.pyc
│  │
│  └─templates
└─test
```
##实现思路：
（实现一次 query发起一次restsql查询流程-->7.28)
1.当django程序驱动时，在RestSQLServer 文件夹中__init__初始化文件夹执行restsql中的config文件夹里面file_setting处理文件，并将其对象存储在db_setting单例对象中（仅在项目启动进行对创建对象）
2. 当发起query查询，views->querysearch开始运行，（因为此时基础框架仅作为读取配置文件数据库信息，生成对象供调用），然后获取协议json字段里面的'from'字段，调用db_setting里面的db_config对象处理，并返回对应的数据库信息（包括，自定义数据源名对应的数据库连接所需要的地址用户密码，以及请求的表如非真实表名，还需要进行在文件中找到真实数据表名）
3. 调用es_entry模块，将数据库参数，以及query_json等必要参数传递给do_query方法，启用转义sql,查询功能，并获取查询返回的数据

# restsql.yaml 配置文件结构说明
```yaml
# 考虑到配置文件不宜嵌套太多层，导致文件存取，读取困难，把整个完整结构进行拆分成几个分结构
# table结构 保存数据库中 是否有些表真实名字不宜直接暴露，需要类似于 域名->ip映射(未指定的表名，就不进行映射转换）
table:
  mymytestsource1: #自己自定义的datasource 配置名（也是用户进行查询中from字段指定的数据库名）
    faketable1: Model1_testuser #前面的faketable1 为指定让用户查询的非真实表名，在这里才进行真实表名映射
    faketable2: table2
  source2: # 此处同上
    faketable3: table3

tablestruct: #考虑到如果使用orm方案，需要事先指定那些表中的字段都是什么类型
  mymytestsource1: #自定义的datasource名
    Model1_testuser: # 真实table名字
      username: String #例如指定 username字段是字典类型
      password: String
    table2:
      username: String
  source2: #同上面部分
    table2:
      username: String


blackcolumn: #指定那个数据库的表里面哪些字段不能查询，为黑名单字段
  mymytestsource1: #不是真实数据库名，而是暴露给用户的datasource代号，在这里作为key,方便直接在字典中通过名字找到value结构
    Model1_testuser: #表名，真实表名 ，下面的结构为数组 list
      - password
      - pid
    table2:
      - username
      - password

blacktable: #指定数据库 中哪些是黑名单字段
  mymytestsource1: #下面结构是数组
    - table4
    - table5
  source2:
    - table7

db: #数据库配置  
  mymytestsource1: #这里暴露给用户的db名字，不将数据库进行暴露
    dbname: testdjango #指定真实数据库名字
    host: 127.0.0.1
    port: 5432
    username: postgres
    password: zhang
    type: sql
  source2: #同上一个   转化成字典结构，方便由于数据源不同，所需要的配置字段不同，其结构灵活
    dbname: test3
    host: 39.106.92.11
    port: 9200
    type: es

```

#程序存储文件配置对象结构说明
1.由上面的yaml文件读取转换而来，使用字段结构进行存储 ，可以支持多数据源，同一个数据源中存储多个表配置（ 多个数据源，多个表，使用特定的名字，在字典中作为key可以直接查询获取value结构的值 ，处理方便，也更快捷
2.由上面的yaml文件中较为零散的结构转化为一个相对完整的结构
```python
# 对象： db_settings 为每一个数据库源配置， tables 为每一个数据库源当中是否还要而外指定表名映射  tables_structs 为sql orm所进行动态类型配置（es如不需要可忽略）
# {
#     db_settings{
#         'name1':{#以用户查询的数据库名字作为key
#             "name":name1,#用户查询的数据库名
#             "dbname": dbname,#真实数据库名
#             "schema":schema,
#             "host": host,
#             "port": port,
#             "username": username,
#             "password": password,
#             "type": type
#             "blacktables":[]
#         }
#         'name2':{
#
#         }
#     }
#     tables:{
#         'name1':{
#           'fake_tablename1': real_tablename1
#           'fake_tablename2': real_tablename2
#         }
#         'name2':{
#         
#           }
#        }
#     tables_struct:{
#         "name1":{#以用户查询的数据库名字（非真实名字）作为key映射，快速查找
#             "table1":{#真实表名
#                 "column1": "String"
#                 "column2": "Integer"
#                 "column3": "Timestamp"
#             }
#             "table2":{
#                 "column1": "xxx"
#                 "column2": "xxx"
#             }
#         }
#         "name2":{
#
#         }
#     }
#     "blackcolumns":{
#           'name1':{#以用户的查询数据库名作为映射
#            "table1":[#这里存放的是真实表名，需要事先进行真实表名替换
#
#           ]
#           }
#          
#      }
#
# }
```

# 基础框架传递给不同数据源调用的 数据源字典对象结构说明
由上面的大结构对象，提取出用户需要的特定数据库对象配置，以及数据表封装成一个字典对象传送给用户
```python
# {
#     'db_setting':{#用户查询的数据库表配置
#         "dbname":xxx
#         "host":xxx
#         "password":xxx
#
#     }
#     'table':[#用户查询可能涉及到多个表的话，考虑到该需求后期可能涉及到，此处使用数组
#             {
#                 'tablename': xxx #在此处获取数据库名
#                 'struct': { #数据库表结构
#                     'column1': Integer #字段类型指定
#                     'column2': String
#                 }
#                 'blackcolumn': []  #该表的黑名单字段
#              }
#          ]
#     'blacktables':[]
# }

```


